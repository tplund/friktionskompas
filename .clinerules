# Claude Code Rules for Friktionskompasset

## ğŸš€ Session Startup

**CRITICAL:** Ved start af hver ny session, lÃ¦s fÃ¸lgende fil fÃ¸rst:
- `SYSTEM_DESIGN.md` - Indeholder alle analyse-kriterier, design decisions og systemdokumentation

Dette sikrer at du arbejder med de korrekte vÃ¦rdier for:
- Severity thresholds
- Gap analysis kriterier
- Spredning (standardafvigelse) levels
- Prioriteringslogik
- KKC framework mapping
- Respondent types
- Database struktur

## ğŸ“ NÃ¥r Kriterier Ã†ndres

Hvis du Ã¦ndrer analyse-kriterier (fx gap threshold, severity levels, spredning):
1. Opdater koden
2. **Opdater SYSTEM_DESIGN.md** med de nye vÃ¦rdier
3. Dokumenter rationale for Ã¦ndringen
4. Test med eksisterende data

## âœ… TODO Management

**KRITISK:** Brug TodoWrite proaktivt for alle opgaver med 3+ steps eller ikke-trivielle tasks.

**NÃ¥r skal du oprette TODOs:**
1. NÃ¥r brugeren beder om en feature med flere steps
2. NÃ¥r du identificerer et problem der krÃ¦ver flere Ã¦ndringer
3. Ved start af complex refactoring
4. NÃ¥r du planlÃ¦gger Ã¦ndringer i analyse-kriterier

**TODO best practices:**
- Opret TODOs INDEN du starter arbejdet
- Marker Ã©n TODO som "in_progress" ad gangen
- Marker som "completed" STRAKS nÃ¥r done
- Opdater liste hvis du finder nye sub-tasks undervejs

**Eksempel workflow:**
```
User: "Vis alle friktioner som liste nÃ¥r scores er tÃ¦tte"
â†’ Opret TODOs fÃ¸rst: [Ã†ndre logik, Opdater template, Opdater docs]
â†’ Marker fÃ¸rste som in_progress
â†’ Implementer
â†’ Marker som completed
â†’ NÃ¦ste task
```

## ğŸ—ï¸ Projekt Konventioner

### Database
- Multi-tenant med customer isolation
- Hierarkisk organisation (trÃ¦struktur)
- 3 respondent types: employee, leader_assess, leader_self

### Kode Stil
- Dansk til UI tekster og kommentarer i templates
- Engelsk til kode, funktionsnavne, variable
- Docstrings pÃ¥ dansk for forretningslogik

### Sprogbrug i UI
**Brug danske udtryk** med mindre engelske er alment udbredte i daglig dansk.

**Acceptable engelske udtryk:**
- "Upload" - bredt anvendt i dansk
- "Download" - bredt anvendt i dansk
- "CSV" - teknisk term
- "gap" i CSS/styling (teknisk kontekst)

**SKAL oversÃ¦ttes:**
- Gap â†’ Forskel (i UI tekst)
- Login â†’ Log ind
- Logout â†’ Log ud
- Start â†’ Start (allerede dansk)
- Alerts & Flags â†’ Advarsler & Fund
- Problem â†’ Problemet
- Bulk Upload â†’ Upload CSV

**Tommelfingerregel:**
Hvis et dansk alternativ ikke virker kunstigt eller tungt, brug dansk. Hvis oversÃ¦ttelsen virker forceret, behold engelsk.

**Eksempler:**
- âœ… "Forskel mellem leder og medarbejder" (ikke "Gap")
- âœ… "Upload CSV" (OK - upload er naturligt i dansk)
- âœ… "Hent rapport" (ikke "Download rapport" - download virker OK, men hent er bedre)
- âœ… "Log ud" (ikke "Logout")
- âŒ "IndlÃ¦s fil" (for tungt - brug "Upload fil")

### Commit Messages
Brug dansk og vÃ¦r beskrivende:
```
TilfÃ¸j spredning til analyse-tabellen

- Beregn standardafvigelse per friktionsfelt
- Vis spredning i sammenligningstabel med farvekodning
- Flag hÃ¸j spredning som alert
- Opdater prioriteringslogik til at favorisere hÃ¸j spredning
```

## âš ï¸ Sikkerhed

- Aldrig commit .env filer
- Aldrig hardcode passwords
- Brug bcrypt til password hashing
- Customer isolation skal altid vÃ¦re aktiv (check `get_customer_filter()`)

## ğŸ§ª Testing

FÃ¸r stÃ¸rre Ã¦ndringer:
1. Test med eksisterende campaigns
2. Check at multi-tenant isolation virker
3. Verificer at alle 3 respondent types fungerer
4. Test bÃ¥de anonymous og identified mode
