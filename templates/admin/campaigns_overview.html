{% extends "admin/layout.html" %}

{% block title %}Analyser{% endblock %}

{% block extra_css %}
<style>
    .card {
        background: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 20px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .campaign-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 20px;
        border-left: 4px solid #3b82f6;
        transition: all 0.2s;
        cursor: pointer;
    }
    .campaign-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }
    .campaign-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 15px;
    }
    .campaign-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 5px;
    }
    .campaign-meta {
        color: #6b7280;
        font-size: 0.875rem;
    }
    .campaign-stats {
        display: flex;
        gap: 20px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e5e7eb;
    }
    .stat-item {
        display: flex;
        flex-direction: column;
    }
    .stat-label {
        font-size: 0.75rem;
        color: #6b7280;
        text-transform: uppercase;
    }
    .stat-value {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
    }
    .btn {
        background: #3b82f6;
        color: white;
        padding: 10px 20px;
        text-decoration: none;
        border-radius: 8px;
        display: inline-block;
        font-weight: 500;
        border: none;
        cursor: pointer;
        font-size: 0.875rem;
        transition: all 0.2s;
    }
    .btn:hover {
        background: #2563eb;
        transform: translateY(-1px);
    }
    .btn-success {
        background: #10b981;
    }
    .btn-success:hover {
        background: #059669;
    }
    .btn-delete {
        background: transparent;
        color: #9ca3af;
        padding: 6px 10px;
        font-size: 0.8rem;
        border: 1px solid #e5e7eb;
    }
    .btn-delete:hover {
        background: #fee2e2;
        color: #dc2626;
        border-color: #fecaca;
    }
    .campaign-actions {
        display: flex;
        gap: 8px;
        align-items: center;
    }
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #6b7280;
    }
    .empty-state-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.5;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2>üìà Alle Analyser</h2>
        <a href="/admin/campaign/new" class="btn btn-success">‚ûï Opret Ny Analyse</a>
    </div>

    {% if campaigns %}
        {% for campaign in campaigns %}
        <div class="campaign-card" onclick="window.location='/admin/campaign/{{ campaign.id }}'">
            <div class="campaign-header">
                <div>
                    <div class="campaign-title">{{ campaign.name }}</div>
                    <div class="campaign-meta">
                        üìÖ {{ campaign.period }} ‚Ä¢
                        üè¢ {{ campaign.target_name }}
                    </div>
                </div>
                <div class="campaign-actions">
                    <a href="/admin/campaign/{{ campaign.id }}/detailed"
                       class="btn"
                       style="font-size: 0.8rem; padding: 8px 16px;"
                       onclick="event.stopPropagation();">
                        üìä Se Analyse
                    </a>
                    <button type="button"
                            class="btn btn-delete"
                            onclick="event.stopPropagation(); confirmDeleteCampaign('{{ campaign.id }}', '{{ campaign.name }}', {{ campaign.total_responses or 0 }});">
                        Slet
                    </button>
                </div>
            </div>

            <div class="campaign-stats">
                <div class="stat-item">
                    <span class="stat-label">Respondenter</span>
                    <span class="stat-value">{{ campaign.unique_respondents or 0 }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Svar</span>
                    <span class="stat-value">{{ campaign.total_responses or 0 }}</span>
                </div>
                {% if campaign.tokens_sent > 0 %}
                <div class="stat-item">
                    <span class="stat-label">Sendt</span>
                    <span class="stat-value">{{ campaign.tokens_sent }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Svarprocent</span>
                    <span class="stat-value">{{ "%.0f"|format((campaign.tokens_used / campaign.tokens_sent * 100)) }}%</span>
                </div>
                {% endif %}
                {% if campaign.avg_besvaer %}
                <div class="stat-item">
                    <span class="stat-label">Friktionsscore</span>
                    <span class="stat-value">{{ "%.1f"|format(campaign.avg_besvaer) }}/5</span>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üìä</div>
            <h3 style="margin-bottom: 10px;">Ingen analyser endnu</h3>
            <p style="margin-bottom: 30px;">Opret din f√∏rste analyse for at komme i gang</p>
            <a href="/admin/campaign/new" class="btn btn-success">‚ûï Opret Analyse</a>
        </div>
    {% endif %}
</div>

<script>
function confirmDeleteCampaign(campaignId, campaignName, responseCount) {
    let message = 'ADVARSEL\n\n' +
        `Er du SIKKER p√• at du vil slette m√•lingen "${campaignName}"?\n\n`;

    if (responseCount > 0) {
        message += `Dette vil PERMANENT slette:\n` +
            `- M√•lingen\n` +
            `- ${responseCount} besvarelser\n` +
            `- Alle tilh√∏rende tokens\n\n`;
    } else {
        message += `Dette vil slette m√•lingen og alle tilh√∏rende data.\n\n`;
    }

    message += 'Dette kan IKKE fortrydes!\n\n' +
        'Klik OK for at slette, eller Annuller for at afbryde.';

    if (confirm(message)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/admin/campaign/' + campaignId + '/delete';
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
