{% extends "admin/layout.html" %}

{% block title %}Målingstyper - {{ customer.name }}{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto;">
    <!-- Breadcrumb -->
    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('customers.manage_customers') }}" style="color: #6b7280; text-decoration: none;">← Tilbage til kunder</a>
    </div>

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <div>
            <h1 style="margin: 0; font-size: 1.75rem;">Målingstyper for {{ customer.name }}</h1>
            <p style="color: #666; margin-top: 5px;">Vælg hvilke målingstyper denne kunde har adgang til</p>
        </div>
    </div>

    <!-- Quick Apply Preset -->
    <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 12px; padding: 20px; margin-bottom: 30px;">
        <h3 style="margin: 0 0 15px 0; font-size: 1rem; color: #1e40af;">Anvend preset</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            {% for preset in presets %}
            <form action="{{ url_for('customers.apply_preset_to_customer', customer_id=customer.id, preset_id=preset.id) }}" method="post" style="display: inline;">
                <button type="submit" style="background: {% if preset.is_default %}#3b82f6{% else %}white{% endif %}; color: {% if preset.is_default %}white{% else %}#374151{% endif %}; padding: 10px 20px; border: 1px solid {% if preset.is_default %}#3b82f6{% else %}#d1d5db{% endif %}; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
                    {{ preset.name }}
                    {% if preset.is_default %}<span style="font-size: 0.75rem; opacity: 0.8;">(default)</span>{% endif %}
                </button>
            </form>
            {% endfor %}

            <!-- Reset to default -->
            <form action="{{ url_for('customers.update_customer_assessments', customer_id=customer.id) }}" method="post" style="display: inline;">
                <button type="submit" style="background: #f3f4f6; color: #6b7280; padding: 10px 20px; border: 1px solid #d1d5db; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
                    Brug standard preset
                </button>
            </form>
        </div>
    </div>

    <!-- Custom Configuration -->
    <div style="background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <div style="padding: 20px; border-bottom: 1px solid #e5e7eb;">
            <h2 style="margin: 0; font-size: 1.2rem;">Custom konfiguration</h2>
            <p style="color: #666; margin-top: 5px; font-size: 0.9rem;">
                {% if config.has_custom_config %}
                <span style="color: #059669;">Kunden bruger custom konfiguration</span>
                {% else %}
                <span style="color: #6b7280;">Kunden bruger standard preset</span>
                {% endif %}
            </p>
        </div>

        <form action="{{ url_for('customers.update_customer_assessments', customer_id=customer.id) }}" method="post">
            <div style="padding: 20px;">
                <!-- Individual assessments -->
                <h3 style="margin: 0 0 15px 0; font-size: 1rem; color: #374151;">
                    Individuelle målinger
                </h3>
                <div style="display: grid; gap: 12px; margin-bottom: 30px;">
                    {% for type in config.types %}
                    {% if type.is_individual %}
                    <label style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 1px solid #e5e7eb; border-radius: 10px; cursor: pointer; transition: all 0.2s; {% if type.is_enabled %}background: #f0fdf4; border-color: #86efac;{% endif %}" onmouseover="this.style.borderColor='#3b82f6'" onmouseout="this.style.borderColor='{% if type.is_enabled %}#86efac{% else %}#e5e7eb{% endif %}'">
                        <input type="checkbox" name="assessment_types" value="{{ type.id }}"
                               {% if type.is_enabled %}checked{% endif %}
                               style="width: 20px; height: 20px; accent-color: #3b82f6;">
                        <span style="font-size: 1.5rem;">{{ type.icon }}</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">{{ type.name_da }}</div>
                            <div style="font-size: 0.85rem; color: #6b7280;">{{ type.name_en }}</div>
                        </div>
                        {% if type.is_enabled %}
                        <span style="background: #d1fae5; color: #065f46; padding: 4px 10px; border-radius: 10px; font-size: 0.75rem;">Aktiv</span>
                        {% endif %}
                    </label>
                    {% endif %}
                    {% endfor %}
                </div>

                <!-- Group assessments -->
                <h3 style="margin: 0 0 15px 0; font-size: 1rem; color: #374151;">
                    Gruppe-målinger
                </h3>
                <div style="display: grid; gap: 12px; margin-bottom: 30px;">
                    {% for type in config.types %}
                    {% if not type.is_individual %}
                    <label style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 1px solid #e5e7eb; border-radius: 10px; cursor: pointer; transition: all 0.2s; {% if type.is_enabled %}background: #fffbeb; border-color: #fcd34d;{% endif %}" onmouseover="this.style.borderColor='#3b82f6'" onmouseout="this.style.borderColor='{% if type.is_enabled %}#fcd34d{% else %}#e5e7eb{% endif %}'">
                        <input type="checkbox" name="assessment_types" value="{{ type.id }}"
                               {% if type.is_enabled %}checked{% endif %}
                               style="width: 20px; height: 20px; accent-color: #3b82f6;">
                        <span style="font-size: 1.5rem;">{{ type.icon }}</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">{{ type.name_da }}</div>
                            <div style="font-size: 0.85rem; color: #6b7280;">{{ type.name_en }}</div>
                        </div>
                        {% if type.is_enabled %}
                        <span style="background: #fef3c7; color: #92400e; padding: 4px 10px; border-radius: 10px; font-size: 0.75rem;">Aktiv</span>
                        {% endif %}
                    </label>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>

            <div style="padding: 20px; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 10px;">
                <a href="{{ url_for('customers.manage_customers') }}" style="padding: 10px 20px; border: 1px solid #d1d5db; border-radius: 8px; color: #374151; text-decoration: none;">
                    Annuller
                </a>
                <button type="submit" style="background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                    Gem ændringer
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
